<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>AISPORE Snake v1.1</title>
  <style>
    :root{
      --bg:#07110a;
      --panel:#0e1c12;
      --line:#224a33;
      --text:#e7f5ee;
      --muted:rgba(231,245,238,.65);
      --btn:#162a1e;
      --btnActive:#27583c;
      --tile:#0b1a11;
      --seed:#7bffb6;
      --snake:#35d07f;
      --snakeHead:#a7ffd7;

      --controlsH: 230px;
      --topSafe: env(safe-area-inset-top);
      --botSafe: env(safe-area-inset-bottom);
}

    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;}
body{overflow:hidden;}

    body{overflow:auto;}
    .wrap{
      max-width:720px;
      margin:0 auto;
      box-sizing:border-box;
      height: 100dvh;
      overflow:auto;
      padding: calc(14px + var(--topSafe)) 12px calc(var(--controlsH) + 18px + var(--botSafe));
    }

    .title{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      margin: 4px 0 0;
    }
    .title h1{
      font-size:18px;
      margin:0;
      font-weight:900;
      letter-spacing:.2px;
      line-height:1.05;
    }
    .title .sub{
      font-size:11px;
      color:var(--muted);
      text-align:right;
      line-height:1.15;
      max-width: 55%;
      padding-bottom: 1px;
    }

    .panel{
      margin-top:10px;
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(34,74,51,.65);
      border-radius:18px;
      padding:12px;
      box-shadow:0 10px 40px rgba(0,0,0,.35);
    }

    .hud{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .badge{font-size:12px;color:var(--muted)}
    .score{font-size:14px;font-weight:800}
    .btns{display:flex;gap:8px;flex-wrap:wrap}

    button{
      background:var(--btn);
      border:1px solid rgba(34,74,51,.8);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-weight:800;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      -webkit-user-select:none;
      touch-action:manipulation;
    }
    button:active{background:var(--btnActive)}
    button.secondary{opacity:.85}

    .gameArea{
      margin-top:12px;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:6px 0 6px;
    }

    canvas{
      width: min(96vw, 680px);
      height: min(96vw, 680px);
      max-height: calc(100dvh - (var(--controlsH) + 190px + var(--topSafe) + var(--botSafe)));
      background: radial-gradient(120% 120% at 30% 25%, rgba(15,40,26,.55), rgba(6,12,8,.65));
      border: 1px solid rgba(34,74,51,.75);
      border-radius: 16px;
      image-rendering: pixelated;
      touch-action: none;
      display: block;
      box-shadow: 0 0 0 1px rgba(123,255,182,.08), 0 0 24px rgba(123,255,182,.10);
      animation: aisporeGlow 3.2s ease-in-out infinite;
    }
     aisporeGlow{
      0%,100%{ box-shadow: 0 0 0 1px rgba(123,255,182,.08), 0 0 22px rgba(123,255,182,.10); }
      50%{ box-shadow: 0 0 0 1px rgba(123,255,182,.12), 0 0 34px rgba(123,255,182,.16); }
    }

    .hint{margin-top:8px;font-size:12px;color:var(--muted);text-align:center}
    .log{
      margin-top:10px;
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
      font-size:12px;
      color:rgba(231,245,238,.7);
      background:rgba(0,0,0,.25);
      border:1px solid rgba(34,74,51,.35);
      border-radius:14px;
      padding:10px;
      white-space:pre-wrap;
      min-height:46px;
    }

    .controlsWrap{
      position:fixed;
      left:0; right:0; bottom:0;
      height: calc(var(--controlsH) + var(--botSafe));
      padding-bottom: var(--botSafe);
      display:flex;
      align-items:flex-end;
      justify-content:center;
      background:linear-gradient(180deg, rgba(7,17,10,0), rgba(7,17,10,.92) 26%, rgba(7,17,10,.99));
      z-index:999;
      pointer-events:auto;
    }

    .controls{
      width: fit-content;
      display:grid;
      grid-template-columns:60px 60px 60px;
      grid-template-rows:60px 60px 60px;
      gap:10px;
      padding: 10px 0 16px;
      margin-bottom: 6px;
    }

    .pad{
      background:rgba(22,42,30,.92);
      border:2px solid rgba(47,93,69,.85);
      border-radius:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:20px;
      user-select:none;
      -webkit-user-select:none;
      touch-action:manipulation;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    .pad:active{background:rgba(39,88,60,.95)}
    .empty{background:transparent;border:none}

    .tinyNote{
      position:fixed;
      left:0; right:0;
      bottom: calc(var(--controlsH) + var(--botSafe) - 18px);
      text-align:center;
      color:rgba(231,245,238,.45);
      font-size:10px;
      letter-spacing:.3px;
      pointer-events:none;
      z-index:1000;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">
      <h1>üçÑ AISPORE Snake</h1>
      <div class="sub">Nokia-style ‚Ä¢ underground growth</div>
    </div>

    <div class="panel">
      <div class="hud">
        <div>
          <div class="score">Score: <span id="score">0</span> ‚Ä¢ Best: <span id="best">0</span></div>
          <div class="badge" id="state">Paused</div>
        </div>
        <div class="btns">
          <button id="start">Start</button>
          <button id="pause" class="secondary">Pause</button>
          <button id="restart" class="secondary">Restart</button>
        </div>
      </div>

      <div class="gameArea">
        <canvas id="c" width="520" height="520"></canvas>
      </div>

      <div class="hint">iPhone: k√§yt√§ nuolia alhaalla ‚Ä¢ Mac: nuolin√§pp√§imet / space pause</div>
      <div class="log" id="log">AISPORE grows underground üå±  (Next: Telegram /snake link + score submit)</div>
    </div>
  </div>

  <div class="tinyNote">Controls</div>

  <div class="controlsWrap">
    <div class="controls" aria-label="Mobile controls">
      <div class="pad empty"></div>
      <div class="pad" data-dir="up">‚¨ÜÔ∏è</div>
      <div class="pad empty"></div>

      <div class="pad" data-dir="left">‚¨ÖÔ∏è</div>
      <div class="pad empty"></div>
      <div class="pad" data-dir="right">‚û°Ô∏è</div>

      <div class="pad empty"></div>
      <div class="pad" data-dir="down">‚¨áÔ∏è</div>
      <div class="pad empty"></div>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');

  const logEl = document.getElementById('log');
  const scoreEl = document.getElementById('score');
  const bestEl = document.getElementById('best');
  const stateEl = document.getElementById('state');

  const GRID = 24;
  const SPEED_MS = 110;
  const TILE = canvas.width / GRID;

  const dirs = {
    up:    {x:0,y:-1},
    down:  {x:0,y:1},
    left:  {x:-1,y:0},
    right: {x:1,y:0},
  };

  let snake, dir, nextDir, seed, running=false, timer=null, score=0;
  let best = Number(localStorage.getItem('aispore_best')||0);
  bestEl.textContent = String(best);

  function setLog(m){ logEl.textContent = m; }
  function setState(m){ stateEl.textContent = m; }

  function randCell(excludeSet){
    while(true){
      const x = Math.floor(Math.random()*GRID);
      const y = Math.floor(Math.random()*GRID);
      const k = x+','+y;
      if(!excludeSet || !excludeSet.has(k)) return {x,y};
    }
  }

  function reset(){
    const cx = Math.floor(GRID/2);
    const cy = Math.floor(GRID/2);
    snake = [
      {x:cx, y:cy},
      {x:cx-1, y:cy},
      {x:cx-2, y:cy},
    ];
    dir = dirs.right;
    nextDir = dir;
    score = 0;
    scoreEl.textContent = '0';
    const occ = new Set(snake.map(p=>p.x+','+p.y));
    seed = randCell(occ);
    draw();
    setState('Paused');
    setLog('AISPORE grows underground üå±  Eat seeds to spread the spore.');
  }

  function start(){
    if(running) return;
    running = true;
    setState('Running');
    timer = setInterval(tick, SPEED_MS);
  }

  function pause(){
    if(!running) return;
    running = false;
    clearInterval(timer); timer=null;
    setState('Paused');
  }

  function restart(){
    pause();
    reset();
  }

  function opposite(a,b){ return a.x + b.x === 0 && a.y + b.y === 0; }

  function setDirection(name){
    const nd = dirs[name];
    if(!nd) return;
    if(opposite(nd, dir)) return;
    nextDir = nd;
  }

  function tick(){
    dir = nextDir;

    const head = snake[0];
    const nh = {x: head.x + dir.x, y: head.y + dir.y};

    if(nh.x < 0 || nh.x >= GRID || nh.y < 0 || nh.y >= GRID){
      return gameOver('Hit the wall.');
    }

    for(let i=0;i<snake.length;i++){
      if(snake[i].x===nh.x && snake[i].y===nh.y){
        return gameOver('Hit yourself.');
      }
    }

    snake.unshift(nh);

    if(nh.x === seed.x && nh.y === seed.y){
      score += 1;
      scoreEl.textContent = String(score);
      if(score > best){
        best = score;
        localStorage.setItem('aispore_best', String(best));
        bestEl.textContent = String(best);
      }
      const occ = new Set(snake.map(p=>p.x+','+p.y));
      seed = randCell(occ);
    } else {
      snake.pop();
    }

    draw();
  }

  function gameOver(reason){
    pause();
    setState('Game Over');
    setLog('Game Over ‚Äî ' + reason + '  Score: ' + score + '  (Restart)');
  }

  function rect(x,y,w,h,fill,stroke){
    if(fill){ ctx.fillStyle = fill; ctx.fillRect(x,y,w,h); }
    if(stroke){ ctx.strokeStyle = stroke; ctx.strokeRect(x,y,w,h); }
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    for(let y=0;y<GRID;y++){
      for(let x=0;x<GRID;x++){
        const px = x*TILE, py=y*TILE;
        rect(px,py,TILE,TILE,'rgba(11,26,17,.75)','rgba(34,74,51,.12)');
      }
    }

    const sx = seed.x*TILE, sy=seed.y*TILE;
    ctx.fillStyle = 'rgba(123,255,182,.18)';
    ctx.beginPath();
    ctx.arc(sx+TILE/2, sy+TILE/2, TILE*0.42, 0, Math.PI*2);
    ctx.fill();
    rect(sx+TILE*0.18, sy+TILE*0.18, TILE*0.64, TILE*0.64, 'rgba(123,255,182,.92)', 'rgba(255,255,255,.08)');

    for(let i=snake.length-1;i>=0;i--){
      const p = snake[i];
      const px = p.x*TILE, py=p.y*TILE;
      const isHead = i===0;
      rect(px+2,py+2,TILE-4,TILE-4, isHead ? 'rgba(167,255,215,.95)' : 'rgba(53,208,127,.9)', 'rgba(0,0,0,.18)');
      if(isHead){
        ctx.fillStyle = 'rgba(0,0,0,.45)';
        ctx.beginPath(); ctx.arc(px+TILE*0.68, py+TILE*0.35, TILE*0.06, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(px+TILE*0.68, py+TILE*0.65, TILE*0.06, 0, Math.PI*2); ctx.fill();
      }
    }
  }

  window.addEventListener('keydown', (e) => {
    const k = e.key;
    if(k==='ArrowUp') setDirection('up');
    else if(k==='ArrowDown') setDirection('down');
    else if(k==='ArrowLeft') setDirection('left');
    else if(k==='ArrowRight') setDirection('right');
    else if(k===' '){ running ? pause() : start(); }
  });

  document.getElementById('start').onclick = start;
  document.getElementById('pause').onclick = pause;
  document.getElementById('restart').onclick = restart;

  document.querySelectorAll('.pad[data-dir]').forEach(el=>{
    el.addEventListener('touchstart', (e)=>{ e.preventDefault(); setDirection(el.dataset.dir); }, {passive:false});
    el.addEventListener('mousedown', (e)=>{ e.preventDefault(); setDirection(el.dataset.dir); });
  });

  let sx0=0, sy0=0, swiping=false;
  canvas.addEventListener('touchstart', (e)=>{
    if(!e.touches || !e.touches[0]) return;
    swiping=true;
    sx0=e.touches[0].clientX; sy0=e.touches[0].clientY;
  }, {passive:true});
  canvas.addEventListener('touchend', (e)=>{
    if(!swiping) return;
    swiping=false;
    const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
    if(!t) return;
    const dx = t.clientX - sx0;
    const dy = t.clientY - sy0;
    if(Math.abs(dx) < 18 && Math.abs(dy) < 18) return;
    if(Math.abs(dx) > Math.abs(dy)) setDirection(dx>0?'right':'left');
    else setDirection(dy>0?'down':'up');
  }, {passive:true});

  reset();
})();
</script>

<script id="AISPORE_V1_1_SPOREBURST">
(function(){
  const rand=(a,b)=>a+Math.random()*(b-a);

  function ensureCanvas(){
    let c=document.getElementById("sporefx");
    if(!c){
      c=document.createElement("canvas");
      c.id="sporefx";
      c.style.position="fixed";
      c.style.left="0";
      c.style.top="0";
      c.style.width="100vw";
      c.style.height="100vh";
      c.style.pointerEvents="none";
      c.style.zIndex="9999";
      document.body.appendChild(c);
    }
    const dpr=window.devicePixelRatio||1;
    c.width=Math.floor(window.innerWidth*dpr);
    c.height=Math.floor(window.innerHeight*dpr);
    return {c,ctx:c.getContext("2d"),dpr};
  }

  let audioOk=false;
  const eatSound=(()=>{
    try{
      const C=window.AudioContext||window.webkitAudioContext;
      if(!C) return null;
      return new C();
    }catch{return null;}
  })();

  function playEat(){
    if(!eatSound) return;
    try{
      const ctx=eatSound;
      if(ctx.state==="suspended") ctx.resume().catch(()=>{});
      const o=ctx.createOscillator();
      const g=ctx.createGain();
      o.type="sine";
      o.frequency.value=440;
      g.gain.value=0.0001;
      o.connect(g); g.connect(ctx.destination);
      const t=ctx.currentTime;
      g.gain.exponentialRampToValueAtTime(0.08,t+0.01);
      g.gain.exponentialRampToValueAtTime(0.0001,t+0.08);
      o.start(t);
      o.stop(t+0.09);
    }catch{}
  }

  let particles=[];
  function burst(x,y){
    const {c,ctx,dpr}=ensureCanvas();
    const px=x*(dpr||1);
    const py=y*(dpr||1);
    for(let i=0;i<14;i++){
      particles.push({
        x:px,y:py,
        vx:rand(-2.2,2.2)*(dpr||1),
        vy:rand(-2.2,2.2)*(dpr||1),
        r:rand(2.0,4.5)*(dpr||1),
        a:1,
        life:rand(18,26)
      });
    }
    playEat();
    if(!audioOk){
      audioOk=true;
      try{ if(eatSound && eatSound.state==="suspended") eatSound.resume().catch(()=>{}); }catch{}
    }
    if(!burst._anim) burst._anim=requestAnimationFrame(tick);
  }

  function tick(){
    burst._anim=null;
    const c=document.getElementById("sporefx");
    if(!c) return;
    const ctx=c.getContext("2d");
    ctx.clearRect(0,0,c.width,c.height);
    particles=particles.filter(p=>p.life>0 && p.a>0.02);
    for(const p of particles){
      p.x+=p.vx; p.y+=p.vy;
      p.vx*=0.94; p.vy*=0.94;
      p.life-=1;
      p.a*=0.93;
      ctx.globalAlpha=p.a;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fill();
    }
    ctx.globalAlpha=1;
    if(particles.length) burst._anim=requestAnimationFrame(tick);
  }

  window.AISPORE_SPORE_BURST=burst;
})();

<script>
window.onAteFood = function(x,y){
  try{
    // x,y in page coordinates if provided, else center
    const cx = (typeof x==="number") ? x : (window.innerWidth*0.5);
    const cy = (typeof y==="number") ? y : (window.innerHeight*0.45);
    if(window.AISPORE_SPORE_BURST) window.AISPORE_SPORE_BURST(cx,cy);
  }catch{}
};
</script>
</body>
</html>
